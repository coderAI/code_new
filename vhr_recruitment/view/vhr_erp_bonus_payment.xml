<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <record id="view_vhr_erp_bonus_payment_form" model="ir.ui.view">
            <field name="name">vhr.erp.bonus.payment.form</field>
            <field name="model">vhr.erp.bonus.payment</field>
            <field name="arch" type="xml">
                <form string="ERP Bonus Payment" version="7.0" duplicate='false' delete="0">
       				<sheet>
       					<group string="Payment info" col="4">
       						<field name="job_id" string="Request" required="1" 
       							attrs="{'readonly' :[('is_edit','=', False)]}"
       							on_change="onchange_bonus_payment(job_id, applicant_id)"
       							context="{'tree_view_ref': 'vhr_recruitment.view_vhr_resource_request_tree',
       									  'search_view_ref': 'vhr_recruitment.view_vhr_resource_request_search'}"
       							options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
       						<field name="applicant_id" required="1" 
       							attrs="{'readonly' :[('is_edit','=', False)]}"
       							on_change="onchange_bonus_payment(job_id, applicant_id)"
                            	options="{'no_quick_create' : True, 'no_create':True}"/>
       						<field name="recommender_id" required="1" 
       							attrs="{'readonly' :[('is_edit','=', False)]}"
       							options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>                                   						
                            <field name="department_id" required="1" 
                            	attrs="{'readonly' :[('is_edit','=', False)]}"
                            	options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
                            <field name="job_family_id" required="1" 
                            	attrs="{'readonly' :[('is_edit','=', False)]}"
                            	options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
       						<field name="job_group_id" required="1" 
       							attrs="{'readonly' :[('is_edit','=', False)]}"
       							options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
<!--        						<field name="job_level_id" required="1"  -->
<!--        						attrs="{'readonly' :[('is_edit','=', False)]}" -->
<!--        							options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/> -->
       							
       						<field name="erp_level_id" required="1" 
       						attrs="{'readonly' :[('is_edit','=', False)]}"
       							options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
       						
       						<field name="job_level_position_id" required="1"
       						    attrs="{'readonly' :[('is_edit','=', False)]}"
       							options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
       						
       						<field name="job_title_id" required="1" 
       							attrs="{'readonly' :[('is_edit','=', False)]}"
       							options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
       						
       						<field name="bonus_scheme_id" required="1"
       							attrs="{'readonly' :[('is_edit','=', False)]}"
       							on_change="onchange_bonus_scheme_id(bonus_scheme_id)" 
       							options="{'no_quick_create' : True, 'no_create':True}"/>
       							
       						<field name="exclusion_id" options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
       						<field name="total_bonus" options="{'save_readonly' : True}" readonly="1"/>
       						<field name="active" invisible="1"/>
       						<field name="is_specialerp" readonly="1"/>
       					</group>
       					<group>
       						<field name="note"/>
       						<field name="is_edit" invisible="1"/>
       					</group>
       					<notebook>
       						<page string="Payment Lines">
       							<field name="payment_line_ids">
       								<tree string="Payment lines" version="7.0" editable="1">
       									<field name="payment_time_id" required="1"
       										attrs="{'readonly' :[('state','!=', 'draft')]}"
       										options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
       									<field name="payment_date"
       										attrs="{'readonly' :[('state','!=', 'draft')]}"
       										required="1"/>
       										
       									<field name="payment_rate"
	       									attrs="{'readonly' :[('state','!=', 'draft')]}"
	       									required="1"/>
	       									
       									<field name="payment_value"
       										attrs="{'readonly' :[('state','!=', 'draft')]}"
       										required="1"/>
	       								
										<field name="state" 
											attrs="{'readonly' :[('state','!=', 'draft')]}"
											readonly="1" invisible="0"/>
										<button name="action_payment" states="draft" type="object" 
											confirm="Are you sure you want to execute ?" icon="kanban-apply"
											string="Payment" class="oe_highlight"/>
										<button name="action_cancel" states="draft" type="object" 
											confirm="Are you sure you want to execute ?" icon="gtk-cancel" 
											string="Cancel" class="oe_highlight"/>
									</tree>
       							</field>
       						</page>
	       					<page string="Logs">
		                        	<label string="*** Please press F5 to refresh the list of logs !" colspan="4"/>
			                        <field name="audit_log_ids" mode="tree"
			                               widget="one2many_list" readonly="1" nolabel="1" colspan="4">
			                            <tree version="7.0">
			                                <field name="timestamp" required="1" readonly="1"/>
			                                <field name="user_id" readonly="1"/>
			                                <field name="method" readonly="1"/>
			                                <field name="field_description"/>
			                                <field name="old_value_text"/>
			                                <field name="new_value_text"/>
			                            </tree>
			                        </field>
		                        </page>
		            	</notebook>
       				</sheet>
       			</form>
            </field>
        </record>

        <record id="view_vhr_erp_bonus_payment_tree" model="ir.ui.view">
            <field name="name">vhr.erp.bonus.payment.tree</field>
            <field name="model">vhr.erp.bonus.payment</field>
            <field name="arch" type="xml">
                <tree string="ERP Payment Bonus" version="7.0" delete="0">
                	<field name="job_id"/>
                    <field name="recommender_id"/>
                    <field name="applicant_id"/>
                    <field name="job_title_id" string ="Title Offer"/>
                    <field name="department_id"/>
                    <field name="job_family_id"/>
					<field name="job_group_id"/>
					<field name="erp_level_id"/>
					<field name="total_bonus"/>
					<field name="exclusion_id" invisible="1"/>
					<field name="note" invisible="1"/>	
					<field name="is_specialerp" readonly="1"/>				
                </tree>
            </field>
        </record>

        <record id="view_vhr_erp_bonus_payment_search" model="ir.ui.view">
            <field name="name">vhr.erp.bonus.payment.search</field>
            <field name="model">vhr.erp.bonus.payment</field>
            <field name="arch" type="xml">
                <search string="Search">
                	<field name="recommender_id" string="Bonus Payment" 
        			 filter_domain="['|',('recommender_id.name','ilike',self),('applicant_id.name','ilike',self)]"/>
      			 	<group expand="0" string="Group By">
                        <filter name="group_by_recommender_id" string="Recommender"
                               context="{'group_by':'recommender_id'}"/>
                               
                        <filter name="group_by_department" string="Department"
                               context="{'group_by':'department_id'}"/>
                        <filter name="group_by_job_family" string="Job Family"
                               context="{'group_by':'job_family_id'}"/>
                               
                         <filter name="group_by_erp_level" string="ERP Level"
                               context="{'group_by':'erp_level_id'}"/>
                               
                        <filter name="group_by_total_bonus" string="Total Bonus"
                               context="{'group_by':'total_bonus'}"/>
                    </group>
                    <group expand="0" string="Filter">
                    	<filter name="filter_not_exclusion" string="Not exclusion"
	                               domain="[('exclusion_id', '=', None)]"/>
	                    <filter name="filter_exclusion" string="Exclusion"
	                               domain="[('exclusion_id', '!=', None)]"/>
	                               
	                    <filter string="Active = True" name="active_true" icon="terp-stage"
                            domain="[('active', '=', True)]"/>
	                    <filter string="Active = False" name="active_false" icon="STOCK_NEW"
	                            domain="[('active', '=', False)]"/>
	                    
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="act_vhr_erp_bonus_payment">
            <field name="name">ERP Payment</field>
            <field name="res_model">vhr.erp.bonus.payment</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_filter_not_exclusion': 1,
            	'rule_for_tree_form': True, 'attachment': False}</field>
            <field name="view_id" ref="view_vhr_erp_bonus_payment_tree"/>
            <field name="search_view_id" ref="view_vhr_erp_bonus_payment_search"/>
        </record>
    </data>
</openerp>