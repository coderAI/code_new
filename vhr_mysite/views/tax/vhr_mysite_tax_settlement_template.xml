<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
    
    	<template id="vhr_mysite.vhr_tax_settlement" name="Ủy quyền Quyết toán thuế">
			<t t-call="website.layout">
				<div class="info-wrap my_tax_settlement">
					<div class="title-info"><h6>Ủy quyền Quyết toán thuế</h6></div>
					
					<t t-if="is_cb">
						<div class="search-div search-employee col-xs-12">
							<input data-toggle="tooltip" role="tooltip"
		              			class="input_txt_search todo-search-field" data-placement="bottom"
		              			title="Nhập chính xác domain acc hoặc mã nhân viên"
		              			data-delay='{"show":"500", "hide":"100"}'
		              			type="search" value="" placeholder="Tìm kiếm ..."
		              			id="input_employee_search"/>
		              		<i class="fa fa-search fa-lg btn_txt_search" id="btn_employee_search"></i>
						</div>
						<div class="col-xs-12 search_employee_info" t-if="show_employee_info">
							<table class="table table-striped table-bordered">
								<thead>
									<tr>
										<th>Tên nhân viên</th>
										<th>Mã nhân viên</th>
										<th>Mã số thuế TNCN</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td class="col-xs-4"><span t-esc="employee and employee.name or ''" /></td>
										<td class="col-xs-4"><span t-esc="employee and employee.code or ''" /></td>
										<td class="col-xs-4"><span t-esc="pit_number or ''" /></td>
									</tr>
								</tbody>
							</table>
						</div>
					</t>
					
					<form action="/mysite/tax_settlement_auth" method="post" data-toggle="validator" role="form">
						<input t-if="is_cb" type="text"
								t-att-value="employee and employee.code or ''"
								name="employee_code" style="display:none;"/>
						<div class="form-group col-xs-12">
							<label for="select-year">Chọn năm: </label>
							<select id="select-year" name="select-year" required="required">
								<option value=""></option>
								<t t-if="years">
									<t t-foreach="years" t-as="year">
										<option t-att-value="year">
											<span t-esc="year" />
										</option>
									</t>
								</t>
							</select>
						</div>
						<div class="form-group col-xs-12">
							<h5>Chọn một trong các trường hợp ủy quyền quyết toán bên dưới:</h5>
						</div>
			    		<div class="form-group col-xs-12">
		    				<label>
		    					<input type="radio"
   									name="settlement"
   									value="0" required="required"/>
   								Tôi chỉ có thu nhập chịu thuế tại một nơi là .
   							</label>
			    		</div>
			    		<div class="form-group col-xs-12">
		    				<label>
		    					<input type="radio"
   									name="settlement"
   									value="1"/>
   								Tôi có thu nhập chịu thuế tại ... và có thu nhập vãng lai ở các nơi khác bình
   								quân tháng trong năm không quá 10 triệu đồng/tháng đã được đơn vị trả thu nhập khấu trừ tại nguồn.
   							</label>
			    		</div>
			    		<div class="form-group col-xs-12">
		    				<label>
		    					<input type="radio"
   									name="settlement"
   									value="2"/>
   								Tôi có thu nhập chịu thuế tại ... và có thu nhập từ cho thuê nhà, mặt bằng,
   								quyền sử dụng đất mà có mức doanh thu từ cho thuê nhà, mặt bằng, 
   								quyền sử dụng đất bình quân tháng trong năm không quá 20 triệu đồng/tháng đã 
   								thực hiện nộp thuế tại nơi có nhà, mặt bằng, quyền sử dụng đất cho thuê.
   							</label>
			    		</div>
			    		<div class="form-group col-xs-12 text-center">
						    <button type="submit" class="btn btn-primary"
						    		onclick="return confirm('Bạn chắc chắn những thông tin trên là chính xác?')">In PDF</button>
						</div>
			    	</form>
				</div>
			</t>
    	</template>
    	
    	<template id="vhr_mysite.vhr_tax_settlement_result" name="Kết quả Quyết toán thuế">
    		<t t-call="website.layout">
    			<t t-if="message">
					<div class="my_notices">
						<div class="my_system_notice">
							<i class="fa fa-exclamation-triangle"></i><span t-esc="message" />
						</div>
					</div>
				</t>
				<!-- Neu active form hoac la cb nhung chua active form -->
				<t t-if="active_form or (not active_form and is_cb)">
					<div class="title-info"><h6>Kết quả Quyết toán thuế</h6></div>
					
					<div class="info-wrap my_tax_settlement">
						<div class="select-year col-xs-5 text-left">
							<label for="select-year">Chọn năm: </label>
							<select id="select-year" name="select-year">
								<option value=""></option>
								<t t-foreach="years" t-as="year">
									<t t-if="year == selected_year">
										<option selected="selected" t-att-value="year and 'tax_settlement_' + str(year) or -1">
											<span t-esc="year" />
										</option>
									</t>
									<t t-if="year != selected_year">
										<option t-att-value="year and 'tax_settlement_' + str(year) or -1">
											<span t-esc="year" />
										</option>
									</t>
								</t>
							</select>
						</div>
						<t t-if="is_cb">
							<div class="search-div search-employee col-xs-6">
								<input data-toggle="tooltip" role="tooltip"
			              			class="input_txt_search todo-search-field" data-placement="bottom"
			              			title="Nhập chính xác domain acc hoặc mã nhân viên"
			              			data-delay='{"show":"500", "hide":"100"}'
			              			type="search" t-att-value="query or ''" placeholder="Tìm kiếm ..."
			              			id="input_tax_settlement_search"/>
			              		<i class="fa fa-search fa-lg btn_txt_search" id="btn_tax_settlement_search"></i>
							</div>
						</t>
						<t t-if="taxs">
							<t t-foreach="taxs" t-as="tax">
								<t t-call="vhr_mysite.vhr_tax_settlement_result_detail" />
							</t>
						</t>
					</div>
				</t>
				
				<t t-if="not active_form and not is_cb">
					<t t-call="vhr_mysite.tax_settlement_result_not_avaiable" />
				</t>
			</t>
    	</template>
    	
    	<template id="vhr_mysite.tax_settlement_result_not_avaiable" name="Chi tiết Quyết toán thuế chưa được mở">
			<div class="title-info">
				<h6>Hiện tại chức năng xem Quyết toán thuế chưa được mở.</h6>
				<h6>Bạn vui lòng truy cập lại sau.</h6>
			</div>
		</template>
		
		<template id="vhr_mysite.vhr_tax_settlement_result_detail" name="Chi tiết Quyết toán thuế">
			<div t-att-class="tax and tax.year and 'tax_settlement_' + str(tax.year) +
								(selected_year and (selected_year == str(tax.year)) and ' selected' or '') or 'tax_settlement'">
				<table class="table table-striped table-bordered">
					<tbody>
						<tr>
							<td colspan="4" class="title-info"><h6>Quyết toán thuế <span t-esc="tax.year" /></h6></td>
						</tr>
						<tr>
							<td class="col-xs-3 text-bold">Họ tên:</td>
							<td class="col-xs-3"><span t-esc="employee.resource_id.name"/></td>
							<td class="col-xs-3 text-bold">CMND: (*)</td>
							<td class="col-xs-3"><span t-esc="document and document.number or ''"/></td>
						</tr>
						<tr>
							<td class="text-bold">Ngày cấp: (*)</td>
							<td><span t-esc="document and document.issue_date and format_date(document.issue_date) or ''"/></td>
							<td class="text-bold">Nơi cấp: (*)</td>
							<td><span t-esc="document and document.city_id and document.city_id.name or ''"/></td>
						</tr>
						<tr>
							<td class="text-bold">Mã số thuế: (*)</td>
							<td><span t-esc="pit_number or ''"/></td>
							<td class="text-bold">Ủy quyền quyết toán: (*)</td>
							<td>
								<t t-if="tax and tax.is_settlement_by_company">
									<i class="text-lg fa fa-check-circle text-primary"></i>
									&#160; <span>Có ủy quyền</span>
								</t>
								<t t-if="not tax or tax.is_settlement_by_company == False">
									<i class="text-lg fa fa-times-circle text-danger"></i>
									&#160; <span>Không ủy quyền</span>
								</t>
							</td>
						</tr>
					</tbody>
				</table>
				<br />
				<table class="table table-striped table-bordered">
					<tbody>
						<tr>
							<td colspan="4" class="line-total">PHẦN THU NHẬP TRONG NĂM</td>
						</tr>
						<tr>
							<td class="text-left col-xs-7">Tổng thu nhập phát sinh trong năm</td>
							<td class="col-xs-1">(1)</td>
							<td class="col-xs-2"></td>
							<td class="text-right"><span t-esc="format_money(tax.year_total_income)" /></td>
						</tr>
						<tr>
							<td class="text-left">Tổng thu nhập được khấu trừ thuế trong năm <br/>
								<span class="text-small">(BHXH, BHYT, BHTN, Ngoài giờ không tính thuế, Tiền cơm được miễn thuế)</span>
							</td>
							<td>(2)</td>
							<td></td>
							<td class="text-right"><span t-esc="format_money(tax.year_total_income_sub_tax)" /></td>
						</tr>
						<tr>
							<td class="text-left">Số thuế thu nhập cá nhân đã tạm trích năm</td>
							<td>(3)</td>
							<td></td>
							<td class="text-right"><span t-esc="format_money(tax.year_temp_tax)" /></td>
						</tr>
						
						
						<t t-if="tax.is_settlement_by_company">
						
						<tr class="line-emty-half"></tr>
						
						<tr data-toggle="collapse" t-att-data-target="'#tax_settlement_info' + str(tax.id)" class="accordion-toggle">
							<td colspan="4" class="line-subtotal">
								<div class="subtotal-title text-left">
									<span>PHẦN THÔNG TIN CHO CÁC BẠN CÓ ỦY QUYỀN QUYẾT TOÁN THUẾ CHO CÔNG TY</span>
								</div>
								<div class="subtotal-icon text-right">
									<i class="fa fa-angle-down down-icon"></i>
								</div>
							</td>
						</tr>
						
						<tr>
							<td colspan="4" class="collapse_row">
								<div class="accordion-body collapse in" t-att-id="'tax_settlement_info' + str(tax.id)">
									<table class="table table-striped table-bordered">
										<tr>
											<td class="col-xs-7">Tổng số tiền được giảm trừ ứng với người phụ thuộc</td>
											<td class="col-xs-1">(4)</td>
											<!-- <td class="col-xs-2">= 4.1 + 4.2</td> -->
											<td class="col-xs-2"></td>
											<td class="text-right"><span t-esc="format_money(tax.no_month_family_sub)" /></td>
										</tr>
										<!-- <tr>
											<td class="pleft20"><i>Từ tháng 1 đến tháng 6</i></td>
											<td class="pleft20"><i>(4.1)</i></td>
											<td></td>
											<td class="text-right"><span t-esc="format_number(tax.period_01)" /></td>
										</tr>
										<tr>
											<td class="pleft20"><i>Từ tháng 7 đến tháng 12</i></td>
											<td class="pleft20"><i>(4.2)</i></td>
											<td></td>
											<td class="text-right"><span t-esc="format_number(tax.period_02)" /></td>
										</tr> -->
										<tr>
											<td>Tổng giảm trừ bản thân năm</td>
											<td>(5)</td>
											<td></td>
											<td class="text-right"><span t-esc="format_money(tax.year_self_total_sub)" /></td>
										</tr>
										<tr>
											<td>Tổng thu nhập tính thuế năm</td>
											<td>(6)</td>
											<td></td>
											<td class="text-right"><span t-esc="format_money(tax.year_total_tax_income)" /></td>
										</tr>
										<tr>
											<td>Thu nhập tính thuế bình quân</td>
											<td>(7)</td>
											<td>= (6) / 12 tháng</td>
											<td class="text-right"><span t-esc="format_money(tax.tax_avg)" /></td>
										</tr>
										<tr>
											<td>Thuế thu nhập cá nhân bình quân <i>(theo biểu thuế lũy tiến)</i></td>
											<td>(8)</td>
											<td></td>
											<td class="text-right"><span t-esc="format_money(tax.tax_avg_linear)" /></td>
										</tr>
										<tr>
											<td>Tổng thuế thu nhập cá nhân phải đóng năm</td>
											<td>(9)</td>
											<td>= (8) x 12 tháng</td>
											<td class="text-right"><span t-esc="format_money(tax.year_tax)" /></td>
										</tr>
										<tr>
											<td>Số tiền được hoàn lại</td>
											<td>(10)</td>
											<td>= (3) - (9)</td>
											<td class="text-right"><span t-esc="format_money(tax.total_money_return)" /></td>
										</tr>
										<tr>
											<td>Số tiền phải đóng thêm</td>
											<td>(11)</td>
											<td>= (9) - (3)</td>
											<td class="text-right"><span t-esc="format_money(tax.total_money_pay)" /></td>
										</tr>
									</table>
								</div>
							</td>
						</tr>
						
						</t>
					</tbody>
				</table>
				<br />
				<table class="table table-striped table-bordered">
					<tbody>
						<tr>
							<td>
								<i>Chú ý:</i> Các users vui lòng khi xem thông tin ở các mục (*) nếu có bất kỳ thông tin 
								cá nhân nào không đúng/chưa được cập nhật mới nhất hoặc có bất kỳ thắc mắc nào khác, 
								xin vui lòng gửi email hay liên hệ trực tiếp 
								<span style="color: #e74c3c;" t-esc="tax.cb_info or ''" /> để điều chỉnh/cập nhật kịp thời trước ngày 
								<span style="color: #e74c3c;" t-esc="tax.dealine_update or ''" />. Sau thời hạn trên Phòng C&amp;B sẽ tiến 
								hành quyết toán thuế với cục thuế theo thông tin đã nêu trên. 
								Số thuế được hoàn lại/đóng thêm sẽ được cộng thêm/cấn trừ vào trong lương tháng 
								<span style="color: #e74c3c;" t-esc="tax.month_update or ''" />
								<br />
								<b>Chân thành cảm ơn.</b>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</template>
    </data>
</openerp>