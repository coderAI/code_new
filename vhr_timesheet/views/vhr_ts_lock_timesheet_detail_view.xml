<?xml version="1.0" ?>
<openerp>
    <data>
		
    	<record id="view_vhr_ts_lock_timesheet_detail_submit_form" model="ir.ui.view">
        	<field name="name">vhr.ts.lock.timesheet.detail.submit.form</field>
            <field name="model">vhr.mass.movement</field>
            <field name="type">form</field>
            <field name="groups_id" eval="[(4, ref('vhr_timesheet.vhr_cb_timesheet')),(4, ref('vhr_base.hrs_group_system'))]"/>
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <form string="Note" version="7.0">
                    <separator string="Comment" colspan="4" required="context.get('required_comment',False)"/>
                    <footer>
                    	<div>
                    		<button name="execute_workflow"
	                                string="Submit"  one_click_button="True"
	                                type="object" icon="gtk-save"
	                                class="oe_highlight" context="{'ACTION_COMMENT': action_comment}"/>
	                        or
	                        <button string="Cancel" class="oe_link" special="cancel"/>
                    	</div>
                        
                    </footer>
                </form>
            </field>
        </record>
        
        
        <record model="ir.ui.view" id="view_vhr_ts_lock_timesheet_detail_tree">
            <field name="name">vhr.ts.lock.timesheet.detail.tree</field>
            <field name="model">vhr.ts.lock.timesheet.detail</field>
            <field name="groups_id" eval="[(4, ref('vhr_timesheet.vhr_cb_timesheet')),(4, ref('vhr_base.hrs_group_system'))]"/>
            <field name="arch" type="xml">
                <tree string="Lock Timesheet Detail" create='false'>
                    <field name="lock_date"/>
                    <field name="month"/>
                    <field name="year" remove_thousand_seps="1"/>
                    <field name="employee_id"/>
                    <field name="employee_code"/>
                    <field name="department_id"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_vhr_ts_lock_timesheet_detail_form">
            <field name="name">vhr.ts.lock.timesheet.detail.form</field>
            <field name="model">vhr.ts.lock.timesheet.detail</field>
            <field name="groups_id" eval="[(4, ref('vhr_timesheet.vhr_cb_timesheet')),(4, ref('vhr_base.hrs_group_system'))]"/>
            <field name="arch" type="xml">
                <form string="Lock Timesheet Detail" create='false' edit='false'>
                	<header>
       					<field name="state" widget="statusbar" 
							statusbar_visible="lock,unlock"/>
       				</header>
                    <sheet>
                    	<div class="oe_right" name="buttons">
	                        <div class="oe_button_box" attrs="{'invisible': [('is_person_do_action','=',False)]}">
	                            <button string="Unlock" name="open_window" type="object"
	                            	class="oe_stat_button bg_icon_green"
		                            icon="fa-mail-forward"
									context="{'state': state,'action':'unlock'}" states="lock"/>
								
								<button string="Lock" name="open_window" type="object"
									class="oe_stat_button bg_icon_red"
		                            icon="fa-mail-reply"
									context="{'action':'lock','state': state,'required_comment':True}" states="unlock"/>	
								
	                        </div>
                        </div>
                        <group string="General">
                            <field name="lock_date" readonly='1'/>
                            <field name="employee_id" readonly='1'  options="{'no_open': True, 'no_create': True}"/>
                            <field name='department_id' readonly='1' options="{'no_open': True, 'no_create': True}"/>
                            <field name='is_person_do_action' invisible='1'/>
                        </group>
                        <notebook>
	                        <page string="Leave Request">
	                        	<field name='holiday_ids' nolabel='1'
	                        		 context="{'form_view_ref':'vhr_timesheet.view_hr_holidays_new_form'}">
	                        		<tree colors="red:state == 'refuse';blue:state == 'draft';black:state in ('confirm','validate','validate1')" string="Allocation Requests">
					                    <field name="create_date"/>
					                    <field name="employee_code"/>
					                    <field name="employee_id"/>
					                    <field name="company_id" invisible="1"/>
					                    <field name="department_id"/>
					                    <field name="holiday_status_id"/>
					                    <field name="year" invisible="1" options="{'remove_thousand_seps': 1}"/>
					                    <field name="number_of_days_temp" string="Leave Registration" digits="(14, 1)" sum="Total"/>
					                    <field name="date_from"/>
					                    <field name="date_to"/>
					                    <field name="state"/>
					                    <field name="requester_id"/>
					                </tree>
				                </field>
	                        </page>
	                        <page string="Log state changes" attrs="{'invisible': [('state','=',False)]}">
                                    <field name="state_log_ids" readonly="1"/>
                            </page>
                    	</notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_vhr_ts_lock_timesheet_detail_search">
            <field name="name">vhr.ts.lock.timesheet.detail.search</field>
            <field name="model">vhr.ts.lock.timesheet.detail</field>
            <field name="groups_id" eval="[(4, ref('vhr_timesheet.vhr_cb_timesheet')),(4, ref('vhr_base.hrs_group_system'))]"/>
            <field name="arch" type="xml">
                <search string="Lock Timesheet Detail">
                    <field name="month"/>
                    <field name="year"/>
                    <field name="state"/>
                    <group expand="0" string="Group By">
	                    <filter string="Department" icon="terp-stock_symbol-selection" domain="[]"
	                            context="{'group_by':'department_id'}"/>
	                    <filter string="Status" icon="terp-go-home" domain="[]"
	                            name="group_state" context="{'group_by':'state'}"/>
	                    <filter string="Month" icon="terp-go-home" domain="[]"
	                            name="group_month" context="{'group_by':'month'}"/>
	                    <filter string="Year" icon="terp-go-home" domain="[]"
	                            name="group_year" context="{'group_by':'year'}"/>
	                </group>
                    <group expand="0" string="Filter">
        				<filter string="State = Lock" name="active_true" icon="terp-stage"
                            domain="[('state', '=', 'lock')]"/>
	                    <filter string="State = Unlock" name="active_false" icon="STOCK_NEW"
	                            domain="[('state', '=', 'unlock')]"/>
        			</group>
                    <field name="name" string="Employee" 
	                  		filter_domain="['|','|','|',('name','ilike',self),('employee_id.name','ilike',self),('employee_id.login','ilike',self),('employee_id.code','ilike',self)]"/>
                            	
                </search>
            </field>
        </record>

        <record id="action_open_vhr_ts_lock_timesheet_detail" model="ir.actions.act_window">
            <field name="name">Lock Timesheet Detail</field>
            <field name="res_model">vhr.ts.lock.timesheet.detail</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>

    </data>
</openerp>
