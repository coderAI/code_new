<openerp>
    <data>

        <!-- Annual Leave -->

        <record model="ir.ui.view" id="view_holiday_allocation_tree_readonly">
            <field name="name">hr.holidays.allocation.tree.readonly</field>
            <field name="model">hr.holidays</field>
            <field name="arch" type="xml">
                <tree colors="red:state == 'refuse';blue:state == 'draft';black:state in ('confirm','validate','validate1')"
                      string="Annual Leave Balance">
                    <field name="employee_code"/>
                    <field name="employee_id"/>
                    <field name="company_id" invisible='1'/>
                    <field name="department_id"/>
                    <field name="holiday_status_id"/>
                    <field name="year" remove_thousand_seps="1"/>
		
                    <!--<field name="move_days_of_pre_year" string="Moved"/>
                    <field name="actual_days_of_pre_year" options="{'show_zero': 1}"/>
                    <field name="days_taken_of_pre_year" options="{'show_zero': 1}"/>
                    <field name="remain_days_of_pre_year" options="{'show_zero': 1}"/>
                    <field name="expiry_date_of_days_pre_year" options="{'show_zero': 1}"/>
                    <field name="days_of_year" options="{'show_zero': 1}"/>
                    <field name="days_taken_of_year" options="{'show_zero': 1}"/>
                    <field name="remain_days_of_year" options="{'show_zero': 1}"/>-->

                    <field name="total_days" options="{'show_zero': 1}"/>
                    <field name="total_taken_days" options="{'show_zero': 1}"/>
                    <field name="total_destroy_days" options="{'show_zero': 1}"/>
                    <field name="total_remain_days" options="{'show_zero': 1}"/>
                    <field name="days_of_year" invisible="0" options="{'show_zero': 1}"/>
                    <field name="actual_days_of_pre_year"  options="{'show_zero': 1}"/>
                    <field name="state" invisible="1"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="edit_holiday_new">
            <field name="name">Annual Leave</field>
            <field name="model">hr.holidays</field>
            <field name="arch" type="xml">
                <form string="Annual Leave">
                    <field name="type" invisible="1"/>
                    <field name="state" invisible="1"/>
                    <sheet>
                        <group string="Employee Information">
                            <group>
                                <field name="name" invisible="1"/>
                                <field name="is_person_able_to_do_offline" invisible="1"/>
                                <field name="employee_id"
                                       options="{'no_open': True}"
                                       readonly='1'
                                       on_change="onchange_employee_id(employee_id, holiday_status_id)"/>
                                <field name="employee_code" readonly="1" options="{'save_readonly': 1}"
                                       attrs="{'readonly':['|', ('type','=','add'),('holiday_type','=','level')],'invisible':[('holiday_type','!=','employee')]}"
                                        />
                                <field name="job_level_id" on_change="onchange_job_level_id(job_level_id)"
                                       attrs="{'required':[('holiday_type','=','level')], 'readonly': [('type', '=', 'remove'),('state','!=','draft'), ('state','!=','confirm')], 'invisible':[('holiday_type','=','employee')]}"/>
                                <field name="company_id" invisible='1'
                                       on_change="onchange_company_id(employee_id,company_id, holiday_status_id)"/>
                                
                                <field name="is_offline" invisible="1"/>
                            </group>
                            <group>
                                <field name="holiday_type" on_change="onchange_type(holiday_type)" invisible='1'
                                       options="{'save_readonly': 1}"
                                       attrs="{'readonly':['|', '&amp;',('type', '=', 'remove'),('state','!=','draft'), '&amp;', ('type', '=', 'add'), ('state', 'not in', ['confirm', 'draft'])]}"
                                       string="Mode" context="{'employee_id':employee_id, 'company_id': company_id}"/>
                                <field name="job_level_type_id" readonly="1"
                                       attrs="{'required':[('holiday_type','=','level')], 'readonly': [('type', '=', 'remove'),('state','!=','draft'), ('state','!=','confirm')], 'invisible':[('holiday_type','=','employee')]}"
                                       options="{'save_readonly': True}"/>
                                
                                <field name="department_id" readonly="1"
                                       options="{'save_readonly': 1, 'no_open': True, 'no_create': True}"
                                       attrs="{'readonly':['|', ('type','=','add'),('holiday_type','=','level')],'invisible':[('holiday_type','!=','employee')]}"
                                        />
                                <field name="dept_head_id" readonly="1"
                                       options="{'save_readonly': 1, 'no_open': True, 'no_create': True}"
                                       attrs="{'invisible':[('holiday_type','!=','employee')]}"/>
                                <field name="report_to_id" readonly="1"
                                       options="{'save_readonly': 1, 'no_open': True, 'no_create': True}"
                                       attrs="{'invisible':[('holiday_type','!=','employee')]}"/>
                            </group>
                        </group>
                        <group string="Leave Information">
                            <group>
                            	<field name="year" readonly="1" options="{'remove_thousand_seps': 1}" />
                                <field name="holiday_status_id" readonly='0'
                                       options="{'no_open': True, 'no_create': True}"
                                       context="{'employee_id': employee_id, 'company_id': company_id, 'form_view_ref': 'vhr_timesheet.edit_holiday_status_form'}"/>
                                <field name="notes" invisible="1"/>
                            </group>
                            <group>
                                <field name="seniority_leave" options="{'show_zero': 1}" readonly='1'/>
                                <field name="number_of_days_temp" groups="vhr_base.hrs_group_system" 
										attrs="{'readonly': False}"
                                        string="Leave Registration"/>
                            </group>
                        </group>
                        <group>
                        	<group>
                        		<field name="actual_days_of_pre_year" readonly='1' options="{'show_zero': 1}"/>
                        		<field name="days_taken_of_pre_year" options="{'show_zero': 1}"/>
                            	<field name="remain_days_of_pre_year" options="{'show_zero': 1}"/>
                            	<field name="expiry_date_of_days_pre_year" options="{'show_zero': 1}" readonly='1'/>
                            	<field name="move_days_of_pre_year" options="{'show_zero': 1}" string="Moved" readonly='1'/>
                        	</group>
                            <group>
                            	<field name="days_of_year" options="{'show_zero': 1}"/>
	                            <field name="days_taken_of_year" options="{'show_zero': 1}"/>
	                            <field name="remain_days_of_year" options="{'show_zero': 1}"/>
                            </group>
                            
                        </group>
                        <group>
                        	<group>
                        		<field name="total_days" options="{'show_zero': 1}"/>
	                            <field name="total_taken_days" options="{'show_zero': 1}"/>
	                            <field name="total_destroy_days" options="{'show_zero': 1}"/> 
	                            <field name="total_remain_days" options="{'show_zero': 1}"/>
                        	</group>
                        </group>
						<notebook>
                            <page string="Logs" groups="vhr_base.hrs_group_system,vhr_timesheet.vhr_cb_timesheet">
                                <label string="*** Please press F5 to refresh the list of logs !" colspan="4"/>
                                <field name="audit_log_ids" mode="tree"
                                       widget="one2many_list" readonly="1" nolabel="1" colspan="4">
                                    <tree>
                                        <field name="timestamp" required="1" readonly="1"/>
                                        <field name="user_id" readonly="1"/>
                                        <field name="method" readonly="1"/>
                                        <field name="field_description"/>
                                        <field name="old_value_text"/>
                                        <field name="new_value_text"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="view_annual_leave_filter" model="ir.ui.view">
            <field name="name">hr.holidays.annual.leave.filter</field>
            <field name="model">hr.holidays</field>
            <field name="arch" type="xml">
                <search string="Search Annual Leave Balance">                	
                    <group expand="0" string="Group By...">
                        <filter string="Company" icon="terp-personal+" domain="[]" invisible="1"
                                context="{'group_by':'company_id','set_visible':True}"/>
                        <filter string="Department" icon="terp-personal+" domain="[]"
                                context="{'group_by':'department_id','set_visible':True}"/>
                        <filter name="group_employee" string="Employee" icon="terp-personal" domain="[]"
                                context="{'group_by':'employee_id'}"/>
                        <filter name="group_type" string="Leave Type" icon="terp-stock_symbol-selection" domain="[]"
                                context="{'group_by':'holiday_status_id'}"/>
                    </group>
                    <group expand="0" string="Filter by Employee">
                        <filter string="Active Employee" name="active_employee" icon="terp-stage"
                                domain="[('employee_id.active', '=', True)]"/>
                        <filter string="Inactive Employee" name="inactive_employee" icon="terp-stage"
                                domain="[('employee_id.active', '=', False)]"/>
                    </group>
                    <group expand="0" string="Filter">
                        <filter string="Current Year" name="current_year" icon="terp-go-year"
                                domain="[('year','=',context_today().year)]"/>
                    </group>
                    <group expand="0" string="Filter my Annual Leave">
                        <filter string="My Annual Leave" name="by_login_user" icon="terp-go-month"
                                domain="[('employee_id.user_id','=',uid)]"/>
                    </group>
                    <field name="name" string="Annual Leave Balance of Employee"
                           filter_domain="['|','|','|',('name','ilike',self),('employee_id.name','ilike',self),('employee_id.login','ilike',self),('employee_id.code','ilike',self)]"/>
                    <field name="department_id"/>
                    <field name="year"/>
                    <field name="holiday_status_id"/>                    
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="open_allocation_holidays">
            <field name="name">Annual Leave Balance</field>
            <field name="res_model">hr.holidays</field>
            <field name="view_type">form</field>
            <field name="context">{'search_default_active_employee':1,'default_type':'add', 'default_is_offline':
                True,'filter_by_permission':True, 'search_default_current_year': 1,'search_default_by_login_user':1,
                'rule_for_tree_form': True,'create':False,'duplicate':False, 'delete':False,'move':False, 'approve':
                False, 'reject': False,'attachment':False}
            </field>
            					   
            <field name="domain">[('type','=','add')]</field>
            <field name="limit">40</field>
            <field name="view_id" ref="edit_holiday_new"/>
            <field name="search_view_id" ref="view_annual_leave_filter"/>
        </record>

        <record model="ir.actions.act_window.view" id="action_open_allocation_holidays_tree">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            
            <field name="view_id" ref="view_holiday_allocation_tree_readonly"/>
            <field name="act_window_id" ref="open_allocation_holidays"/>
        </record>

        <record model="ir.actions.act_window.view" id="action_open_allocation_holidays_form">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="edit_holiday_new"/>
            <field name="act_window_id" ref="open_allocation_holidays"/>
        </record>


        <!-- Annual Leave Accummulation- Compensatory Leave Accummulation -->
        <record model="ir.ui.view" id="view_annual_leave_accumulation">
            <field name="name">hr.holidays.annual.leave.accumulation</field>
            <field name="model">hr.holidays</field>
            <field name="arch" type="xml">
                <tree colors="blue:move_days_of_pre_year == False"
                      string="Leave Accumulation" editable='bottom' create='false'>
                    <field name="employee_code" readonly='1'/>
                    <field name="employee_id" readonly='1'/>
                    <field name="company_id" invisible='1'/>
                    <field name="department_id" invisible='1'/>
                    <field name="holiday_status_id" readonly='1'/>
                    <field name="year" readonly='1' options="{'remove_thousand_seps': 1}"  remove_thousand_seps="1"/>
                    <field name="total_days_pre_year"/>
                    <field name="destroy_days_of_pre_year"/>
                    <field name="total_taken_days_pre_year"/>
                    <field name="days_of_pre_year"/>
                    <field name="temp_actual_days_of_pre_year" string="Actual Days (Prev. Year)"/>
                    <field name="expiry_date_of_days_pre_year" required='1'/>
                    <field name="notes_of_accumulation"/>
                    <field name="move_days_of_pre_year" readonly='1' string="Move"/>
                    <field name="state" invisible='1'/>
                </tree>
            </field>
        </record>

        <record id="view_accumulation_filter" model="ir.ui.view">
            <field name="name">hr.holidays.accumulation.filter</field>
            <field name="model">hr.holidays</field>
            <field name="arch" type="xml">
                <search string="Search Leave">
                    <group expand="0" string="Group By...">
                        <filter string="Department" icon="terp-personal+" domain="[]"
                                context="{'group_by':'department_id','set_visible':True}"/>
                        <filter name="group_employee" string="Employee" icon="terp-personal" domain="[]"
                                context="{'group_by':'employee_id'}"/>
                        <filter name="group_type" string="Leave Type" icon="terp-stock_symbol-selection" domain="[]"
                                context="{'group_by':'holiday_status_id'}"/>
                        <filter name="group_year" string="Year" icon="terp-stock_symbol-selection" domain="[]"
                                context="{'group_by':'year'}"/>
                    </group>
                    <group expand="0" string="Filter by Employee">
                        <filter string="Active Employee" name="active_employee" icon="terp-stage"
                                domain="[('employee_id.active', '=', True)]"/>
                        <filter string="Inactive Employee" name="inactive_employee" icon="terp-stage"
                                domain="[('employee_id.active', '=', False)]"/>
                    </group>
                    <group expand="0" string="Filter">
                        <filter string="Moved" name="moved"
                                domain="[('move_days_of_pre_year','=',True)]"/>
                        <filter string="Not Move" name="not_move"
                                domain="[('move_days_of_pre_year','=',False)]"/>

                        <filter string="Current Year" name="current_year"
                                domain="[('year','=',(context_today()).strftime('%%Y'))]"/>
                    </group>
                    <field name="name" string="Leave Accumulation of Employee"
                           filter_domain="['|','|','|',('name','ilike',self),('employee_id.name','ilike',self),('employee_id.login','ilike',self),('employee_id.code','ilike',self)]"/>
                    <field name="department_id"/>
                    <field name="year"/>
                    <field name="holiday_status_id"/>
                </search>
            </field>
        </record>

        <!--<record id="act_vhr_holiday_compensation_leave" model="ir.actions.act_window">
            <field name="name">Compensatory Leave Accumulation</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.holidays</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_annual_leave_accumulation"/>
            <field name="domain">[('type','=','add')]</field>
            <field name="context">{'holiday_status_config_name': 'ts.leave.type.overtime.code',
                'search_default_current_year':1}
            </field>
            <field name="search_view_id" ref="view_accumulation_filter"/>
        </record>-->

        <record id="act_vhr_holiday_annual_leave_accumulation" model="ir.actions.act_window">
            <field name="name">Leave Accumulation</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.holidays</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_annual_leave_accumulation"/>
            <field name="domain">[('type','=','add'),('temp_actual_days_of_pre_year','!=',0)]</field>
            <field name="limit">40</field>
            <field name="context">{'search_default_current_year':1, 'get_all':1,'attachment':False,
                'rule_for_tree_form': True, 'approve': False, 'reject': False,'filter_by_permission':True}
            </field>
            <field name="search_view_id" ref="view_accumulation_filter"/>
        </record>

        <record id="action_server_move_days_pre_year_accumulation" model="ir.actions.server">
            <field name="name">Move</field>
            <field name="model_id" ref="model_hr_holidays"/>
            <field name="state">code</field>
            <field name="code">action = self.move_days_pre_year_accumulation(cr, uid, context.get('active_ids', []),
                context=context)
            </field>
        </record>

        <record model="ir.values" id="action_move_days_pre_year_accumulation">
            <field name="key2">client_action_multi</field>
            <field name="model">hr.holidays</field>
            <field name="name">Move</field>
            <field name="value" eval="'ir.actions.server,%d'%action_server_move_days_pre_year_accumulation"/>
            <field name="object" eval="True"/>
        </record>


    </data>
</openerp>