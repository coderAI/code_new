<?xml version="1.0" ?>
<openerp>
    <data>

        <record id="view_vhr_ts_overtime_submit_form" model="ir.ui.view">
            <field name="name">vhr.ts.overtime.subbmit.form</field>
            <field name="model">vhr.ts.overtime</field>
            <field name="type">form</field>
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <form string="Note" version="7.0">
                    <separator string="Comment" colspan="4" required="context.get('required_comment',False)"/>
                    <footer>
                        <button name="execute_workflow"
                                string="Submit" one_click_button="True"
                                type="object" icon="gtk-save"
                                class="oe_highlight" context="{'ACTION_COMMENT': action_comment}"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>


        <record model="ir.ui.view" id="view_vhr_ts_overtime_tree">
            <field name="name">vhr.ts.overtime.tree</field>
            <field name="model">vhr.ts.overtime</field>
            <field name="arch" type="xml">
                <tree string="Overtime" version="7.0" colors="blue:state not in ('finish','cancel')">
                    <field name="request_date"/>	
                    <field name="employee_code"/>
                    <field name="employee_id"/>
                    <field name="department_id"/>
                    <field name="company_id" invisible='1'/>
                    <field name="state"/>
                    <field name="requester_id"/>
                </tree>
            </field>
        </record>
        
        <record model="ir.ui.view" id="view_vhr_ts_overtime_list_tree">
            <field name="name">vhr.ts.overtime.list.tree</field>
            <field name="model">vhr.ts.overtime</field>
            <field name="arch" type="xml">
                <tree string="Overtime" version="7.0" colors="blue:state not in ('finish','cancel')">
                    <field name="request_date"/>
                    <field name="employee_code"/>                                        
                    <field name="employee_id"/>
 					<field name="department_id"/>                   
                    <field name="company_id" invisible='1'/>
                    <field name="state"/>
                    <field name="waiting_for"/>
                    <field name="requester_id"/>
                </tree>
            </field>
        </record>

        <record id="view_vhr_ts_overtime_form" model="ir.ui.view">
            <field name="name">vhr.ts.overtime.form</field>
            <field name="model">vhr.ts.overtime</field>
            <field name="arch" type="xml">
                <form string="Overtime" version="7.0">
                    <header>
                        <field name="state" widget="statusbar" statusbar_visible="draft,approve,finish" class="oe_right" />
                    </header>
                    
                        <div class="oe_right" name="buttons">
                        	<br/>
                            <div class="oe_button_box" attrs="{'invisible': [('is_person_do_action','=',False)]}">
                                <button string="Submit" name="open_window" type="object"
                                		attrs="{'invisible': ['|',('is_offline','=',True),('state','!=','draft')]}"
                                        class="oe_stat_button bg_icon_green"
                                        icon="fa-mail-forward"
                                        context="{'state': state,'action':'submit'}"/>
                                
								<button string="Delete" name="delete_record" states="draft" type="object"
										attrs="{'invisible': [('is_offline','=',True)]}"
                                        confirm="Are you sure you want to delete this record ?"	
                                		invisible="not context.get('ot_registration',False)"
                                        class="oe_stat_button bg_icon_red"
                                        icon="fa-times"
                                        />
                                <button string="Approve" name="open_window" type="object"
                                        class="oe_stat_button bg_icon_green"
                                        icon="fa-mail-forward"
                                        context="{'action':'submit','state': state}" states="approve"/>

                                <button string="Return" name="open_window" type="object"
                                        class="oe_stat_button bg_icon_red"
                                        icon="fa-mail-reply"
                                        context="{'action':'return','state': state, 'required_comment':True}"
                                        states="approve"/>

                                <button string="Reject" name="open_window" type="object"
                                        class="oe_stat_button bg_icon_red"
                                        icon="fa-times"
                                        context="{'action':'reject','state': state, 'required_comment':True}"
                                        states="approve"/>
                            </div>
                        </div>
                        <group>
                        	<group>
                        		<field name="requester_id" readonly='1' options="{'save_readonly': True,'no_open': True}"/>
                        		<field name="employee_id" required='1'
                                   on_change='onchange_employee_id(employee_id)'
                                   context="{'timesheet_detail': 1, 'search_all_employee':1,'tree_view_ref':'vhr_human_resource.view_vhr_human_resource_mimimal_employee_tree'}"
                                   options="{'save_readonly': True,'no_open': True, 'no_create': True}"/>
                        		<field name="employee_code" readonly='1' options="{'save_readonly': True}"/>
                        		<field name="is_offline"  groups="vhr_base.hrs_group_system,vhr_timesheet.vhr_cb_timesheet"
                             	options="{'save_readonly': True}" attrs="{'readonly':[('state','!=','draft')]}"/> 	  
                             	
                                <field name="request_date" invisible='1'/>
	                            <field name="company_id" invisible='1'
	                                   attrs="{'readonly': [('overtime_detail_ids','!=',[])]}"
	                                   options="{'save_readonly': True,'no_open': True, 'no_create': True}"/>
	                            <field name="is_person_do_action" invisible='1'/>
	                            <field name="is_person_do_action_edit" invisible='1'/>
	                            <field name="is_created" invisible='1'/>                 
	                            <field name="is_compensation_leave_job_level" invisible='1'/> 	
                        	</group>
                        	<group>
                        		<field name="department_id" readonly='1'
                                   options="{'save_readonly': True,'no_open': True, 'no_create': True}"/>
                        		<field name="dept_head_id" readonly='1' options="{'save_readonly': True,'no_open': True}"/>
                        		<field name="report_to" readonly='1' options="{'save_readonly': True,'no_open': True}"/>
                        	</group>
                        </group>
                        <notebook>
                            <page string="Overtime Details">
                                <field name="overtime_detail_ids" required='1'
                                       attrs="{'readonly': [('is_person_do_action_edit','=',False)]}"
                                       context="{'default_state': state, 'default_employee_id': employee_id, 'default_request_date': request_date,
                                				 'default_is_compensation_leave':True,
                                			     'default_is_compensation_leave_by_default':is_compensation_leave_job_level}"/>
                            </page>
                            <page string="History" groups="vhr_base.hrs_group_system,vhr_timesheet.vhr_cb_timesheet">
                                <label string="*** Please press F5 to refresh the list of logs !" colspan="4"/>
                                <field name="audit_log_ids" mode="tree"
                                       widget="one2many_list" readonly="1" nolabel="1" colspan="4">
                                    <tree version="7.0">
                                        <field name="timestamp" required="1" readonly="1"/>
                                        <field name="user_id" readonly="1"/>
                                        <field name="method" readonly="1"/>
                                        <field name="field_description"/>
                                        <field name="old_value_text"/>
                                        <field name="new_value_text"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Log status changes">
                                <field name="state_log_ids" readonly="1"/>
                            </page>
                        </notebook>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_vhr_ts_overtime_search">
            <field name="name">vhr.ts.overtime.search</field>
            <field name="model">vhr.ts.overtime</field>
            <field name="arch" type="xml">
                <search string="Search">
                    <group expand="0" string="Group by...">
						<filter name="group_department" string="Department" icon="terp-personal" domain="[]"
                                context="{'group_by':'department_id'}"/>                    	
                        <filter name="group_employee" string="Employee" icon="terp-personal" domain="[]"
                                context="{'group_by':'employee_id'}"/>                        
                        <filter name="group_state" string="Status" icon="terp-stock_effects-object-colorize" domain="[]"
                                context="{'group_by':'state'}"/>
                    </group>                    
                    <group expand="0" string="Filter by Status">
                        <filter string="Draft" name="state_draft" icon="STOCK_NEW"
                                domain="[('state', '=', 'draft')]"/>
                        <filter string="Waiting LM" name="state_approve" icon="STOCK_NEW"
                                domain="[('state', '=', 'approve')]"/>
                        <filter string="Finish" name="state_finish" icon="STOCK_NEW"
                                domain="[('state', '=', 'finish')]"/>
                        <filter string="Cancel" name="state_cancel" icon="STOCK_NEW"
                                domain="[('state', '=', 'cancel')]"/>
                    </group>
                    <group expand="0" string="Filter by Employee">
                        <filter string="Active Employee" name="active_employee" icon="terp-stage"
                                domain="[('employee_id.active', '=', True)]"/>
                        <filter string="Inactive Employee" name="inactive_employee" icon="terp-stage"
                                domain="[('employee_id.active', '=', False)]"/>
                    </group>
                    <group expand="0" string="Filter">
                        <filter string="Current Month Request" name="current_month" icon="terp-go-month"
                                domain="[('request_date','&lt;',(context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')), ('request_date','&gt;=',time.strftime('%%Y-%%m-01'))]"/>
                    	<filter string="Current Year Request" name="current_year" icon="terp-go-month"
                                domain="[('request_date','&lt;=',time.strftime('%%Y-12-31')), ('request_date','&gt;=',time.strftime('%%Y-01-01'))]"/>
                                	
                    </group>
                    <group expand="0" string="Filter my OT">
                        <filter string="My OT" name="by_login_user" icon="terp-go-month"
                                domain="[('employee_id.user_id','=',uid)]"/>
                    </group>
                    <field name="name" string="Overtime"
                           filter_domain="['|','|','|',('name','ilike',self),('employee_id.name','ilike',self),('employee_id.login','ilike',self),('employee_id.code','ilike',self)]"/>
                    <field name="requester_id"/>
                    <field name="department_id"/>
                </search>
            </field>
        </record>


        <record model="ir.actions.act_window" id="act_my_request_vhr_ts_overtime">
            <field name="name">Overtime Registration</field>
            <field name="res_model">vhr.ts.overtime</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="context">{'search_default_active_employee':1, 'type':'request','ot_registration':1,
            					   'rule_for_tree_form': True,'delete':False,'duplicate':False}</field>
            <field name="view_id" ref="view_vhr_ts_overtime_form"/>
            <field name="search_view_id" ref="view_vhr_ts_overtime_search"/>
        </record>
        
        <record model="ir.actions.act_window" id="action_update_for_ot">
            <field name="name">Update For OT</field>
            <field name="res_model">vhr.ts.overtime</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="context">{'search_default_active_employee':1, 'type':'request','ot_registration':1,
            					   'rule_for_tree_form': True,'delete':False,'duplicate':False,'update_for_ot':True}</field>
            <field name="view_id" ref="view_vhr_ts_overtime_form"/>
            <field name="search_view_id" ref="view_vhr_ts_overtime_search"/>
        </record>

        <record model="ir.actions.act_window" id="act_my_task_vhr_ts_overtime">
            <field name="name">Overtime For Approval</field>
            <field name="res_model">vhr.ts.overtime</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_active_employee':1,'rule_for_tree_form': True, 'create':
                False,'type':'task','duplicate':False }
            </field>
            <field name="view_id" ref="view_vhr_ts_overtime_tree"/>
            <field name="search_view_id" ref="view_vhr_ts_overtime_search"/>
        </record>

        <record model="ir.actions.act_window" id="act_my_list_vhr_ts_overtime">
            <field name="name">List of Overtimes</field>
            <field name="res_model">vhr.ts.overtime</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_active_employee':1,'rule_for_tree_form': True, 'create': False,
                'type':'my_list', 'search_default_current_month': 1,'search_default_group_state': 1,
            	'search_default_by_login_user':1,'duplicate':False}
            </field>
            <field name="limit">40</field>
            <field name="view_id" ref="view_vhr_ts_overtime_list_tree"/>
            <field name="search_view_id" ref="view_vhr_ts_overtime_search"/>
        </record>

        <!--
        <record model="ir.actions.act_window" id="act_my_approve_vhr_ts_overtime">
            <field name="name">My Approvals</field>
         <field name="res_model">vhr.ts.overtime</field>
         <field name="view_type">form</field>
         <field name="view_mode">tree,form</field>
         <field name="context">{'search_default_active_employee':1,'rule_for_tree_form': True, 'create': False, 'delete': False,'type':'approve' }</field>
         <field name="view_id" ref="view_vhr_ts_overtime_tree"/>
         <field name="search_view_id" ref="view_vhr_ts_overtime_search"/>
        </record>
     -->
    </data>
</openerp>
