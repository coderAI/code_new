<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>

        <record id="act_ir_attachment_2_vhr_termination_request" model="ir.actions.act_window">
            <field name="res_model">ir.attachment</field>
            <field name="view_type">form</field>
            <field name="name">Attachment</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('res_model','=','vhr.termination.request'),('res_id','=', active_id)]</field>
            <field name="context">{'search_default_res_id': [active_id], 'default_res_id': active_id,
            	                   'rule_for_tree_form':True,'attachment':False,'create':False,'edit':False}</field>
            <field name="view_id" ref="document.view_document_file_tree"/>
            <field name="search_view_id" ref="base.view_attachment_search"/>	                   
        </record>

        <record id="act_termination_2_working_record" model="ir.actions.act_window">
            <field name="res_model">vhr.working.record</field>
            <field name="view_type">form</field>
            <field name="name">Working Record</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="vhr_human_resource.view_vhr_working_record_waiting_for_public_tree"/>
            <field name="search_view_id" ref="vhr_human_resource.view_vhr_working_record_search"/>
            <field name="domain">[('termination_id','=',active_id)]</field>
            <field name="context">{'default_is_new': False, 'rule_for_tree_form': True, 'publish': False,'create':
                False,'approve':False,'return':False,'reject':False,'duplicate':False, 'default_is_latest': True,
                'record_type': 'record','get_working_record_in_flow': True,'get_office_name_by_code':True,'get_department_name_by_code':True}
            </field>
        </record>

        <record id="view_vhr_termination_request_submit_form" model="ir.ui.view">
            <field name="name">vhr.termination.request.submit.form</field>
            <field name="model">vhr.termination.request</field>
            <field name="type">form</field>
            <field name="priority" eval="20"/>
            <field name="arch" type="xml">
                <form string="Note" version="7.0">
                    <separator string="Comment" colspan="4" required="context.get('required_comment',False)"/>
                    <footer>
                        <button name="execute_workflow"
                                string="Submit"  one_click_button="True"
                                type="object" icon="gtk-save"
                                class="oe_highlight" context="{'ACTION_COMMENT': action_comment}"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>


        <record id="view_vhr_termination_request_form" model="ir.ui.view">
            <field name="name">vhr.termination.request.view.form</field>
            <field name="model">vhr.termination.request</field>
            <field name="arch" type="xml">
                <form string="Termination Request" version="7.0" duplicate='false'>
                    <header>
                        <field name="state" widget="statusbar"
                               statusbar_visible="draft,supervisor,hrbp,dept_head,finish"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <div class="oe_edit_only">
<!--                                <label for="name"/-->
                            </div>
                            <h1>
                                <field name="name" placeholder="Termination Request Number" readonly="1"
                                       options="{'save_readonly': True}"/>
                            </h1>
                        </div>
                        <div class="oe_right" name="buttons">
                            <div class="oe_button_box" attrs="{'invisible': [('is_person_do_action','=',False)]}">
                                <button string="Submit" name="open_window" type="object"
                                        class="oe_stat_button bg_icon_green"
                                        icon="fa-mail-forward"
                                        context="{'state': state, 'is_offline': is_offline ,'is_official': is_official,'action':'submit'}"
                                        states="draft"/>

                                <button string="Approve" name="open_window" type="object"
                                        class="oe_stat_button bg_icon_green"
                                        icon="fa-mail-forward"
                                        context="{'state': state, 'is_offline': is_offline, 'is_official': is_official,'action':'submit'}"
                                        states="supervisor,hrbp,dept_head,cb"/>
                                
                                <!--<button string="Return" name="open_window" type="object"
                                        class="oe_stat_button bg_icon_red"
                                        icon="fa-mail-reply"
                                        save_no_required='True'
                                        context="{'state': state, 'action': 'return', 'required_comment':True, 'is_offline': is_offline, 'is_official': is_official}"
                                        states="supervisor,hrbp,dept_head"/>-->

                                <button string="Reject" name="open_window" type="object"
                                        class="oe_stat_button bg_icon_red"
                                        icon="fa-times"
                                        save_no_required='True'
                                        context="{'state': state,'action':'reject', 'required_comment':True, 'is_offline': is_offline, 'is_official': is_official}"
                                        states="supervisor,hrbp,dept_head,cb"/>
                            </div>
                            <newline/>
                            <div class="oe_right" name="buttons">
                                <button class="oe_stat_button bg_icon_orange"
                                        name="action_print_termination_request" style="width:40px !important"
							   		    save_no_required='True'
                                        states="dept_head,dept_hr,finish" icon="fa-print" type="object"/>
                                <button name="%(act_ir_attachment_2_vhr_termination_request)d"
                                        class="oe_stat_button"
                                        icon="fa-paperclip"
                                        type="action" attrs="{'invisible': [('attachment_count','=', 0)]}">
                                    <field name="attachment_count" widget="statinfo" string="Attachments"/>
                                </button>
                                <button name="%(act_termination_2_working_record)d"
                                        class="oe_stat_button"
                                        icon="fa-book"
                                        type="action"
                                        string="Working Record"
                                        invisible="1"
                                        states="finish">
                                </button>
                                <button string="Cancel" name="open_window" type="object"
                                        class="oe_stat_button bg_icon_red"
                                        icon="fa-times"
                                        save_no_required='True'
                                        groups="vhr_human_resource.vhr_cb_termination"
                                        context="{'state': state ,'action':'cancel', 'required_comment':True}"
                                        states="finish"/>
                            </div>
                        </div>
                        <group></group>
                        <group col="4">
                            <field name="requester_id" readonly='1' 
                             options="{'no_quick_create' : True, 'no_create':True, 'no_open': True,'save_readonly': True}"/>
                            <newline/>
                            <field name="employee_id" required='1' on_change="onchange_employee_id(requester_id, employee_id, is_offline, context)"
	                            	options="{'no_quick_create' : True, 'no_create':True, 'no_open': True,'save_readonly': True}"   
                                   context="{'termination_filter_employee': '1','filter_by_group':'0',
                            				 'is_change_contract_type':is_change_contract_type,
                            				 'tree_view_ref':'vhr_human_resource.view_vhr_human_resource_mimimal_employee_tree'}"/>
                            
                            <field name="employee_code" readonly='1'/>
                            <field name="company_id" required='1' 
								options="{'no_quick_create' : True, 'no_create':True, 'no_open': True,'save_readonly': True}"  
                                   on_change="onchange_company_id(employee_id,company_id, is_offline)"
                                   context="{'employee_id': employee_id}"/>
                            <newline/>
                            <field name="office_id" readonly='1' options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
                            <field name="department_id" readonly='1' options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
                            <field name="contract_id" readonly='1' options="{'no_quick_create' : True, 'no_create':True, 'no_open': True,'save_readonly': True}"/>
                            <field name="contract_type_id" readonly='1' options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
                            <field name="date_start_contract" readonly='1'/>
                            <field name="date_end_contract" readonly='1'/>
                            <field name="job_title_id" readonly='1' options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
                            <!--<field name="job_level_id" readonly='1' options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>-->
                            <field name="is_official" readonly='1' string="Is contract official?"
                              attrs="{'invisible':[('is_hrbp_watching','=',False),('is_requester','=',True)]}"/>
                            <label for="is_change_contract_type" string="Support to change employee type" 
                             class="vhr_human_resource_important_message" 
                            attrs="{'invisible':[('is_hrbp_watching','=',False),('is_requester','=',True)],
                            	    'readonly':['|', ('state', '!=', 'draft'), ('is_cb','=',False)],}"/>
                            	
                            <field name="is_change_contract_type" nolabel='1'
                            	   on_change="onchange_is_change_contract_type(employee_id, is_offline, is_official, is_change_contract_type)"
                                   attrs="{'readonly':['|', ('state', '!=', 'draft'), ('is_cb','=',False)],
                            	           'invisible': [('is_hrbp_watching','=',False),('is_requester','=',True)]}"/>
                            
                            <field name="supervisor_id" readonly='1' options="{'no_quick_create' : True, 'no_create':True, 'no_open': True}"/>
                            <field name="is_offline" readonly='1' options="{'save_readonly':True}"/>	
                            <!--  on_change="onchange_is_offline(is_offline, context)"  context="{'is_official': is_official}"
                                   attrs="{'readonly':['|', ('state', '!=', 'draft'), ('is_hrbp_watching','=',False)]}" -->
							
                            <!--<field name="is_change_contract_type"
                                   attrs="{'readonly':['|', ('state', 'in', ['finish','cancel']), ('is_hrbp_watching','=',False)]}"/>    -->                       
                            <field name="working_record_id" invisible="1"/>
                            <field name="is_probation_contract" invisible="1"/>
                            <field name="create_uid" invisible="1" readonly="1"/>
                            <field name="is_person_do_action" invisible="1"/>
                            <field name="is_hrbp_watching" invisible="1"/>
                            <field name="current_state" invisible="1"/>
                            <field name="dismiss_working_record_ids" invisible="1"/>
                            <field name="can_see_hrbp_update" invisible="1"/>
                            <field name="is_dept_head" invisible="1"/>
                            <field name="is_hrbp" invisible="1"/>
                            <field name="is_assistant_hrbp" invisible='1'/>
                            <field name="is_cb" invisible='1'/>
                            <field name="is_requester" invisible='1'/>
                            <field name="is_lm" invisible='1'/>
                            <field name="is_require_in_hrbp_update" invisible="1"/> 
                            <!--<field name="is_clear_resign_reason_detail" invisible="1"/> 	-->
                            <field name="is_able_to_create_termination" invisible='1'/>	
                            <!--<field name='is_show_comment_log_state_change' invisible='1'/>	-->
                        </group>

                        <group col="4" string="Termination Information">
                            <field name="request_date" readonly="1" options="{'save_readonly': True}"/>
                            <field name="date_end_working_expect" attrs="{'required': 1}"
                                   on_change="onchange_date_end_working_expect(date_end_working_expect,request_date,is_offline)"/>
                            <field name="date_end_working_follow_rule" readonly="1" options="{'save_readonly': True}"
                            class="vhr_human_resource_important_message"/>
                            <field name="date_end_working_approve" options="{'save_readonly': True}"
                                   on_change="onchange_date_end_working_approve(date_end_working_approve,request_date,is_offline)"/>
                            <newline/>
                            <field name="employee_reason" colspan="4" required="1"
                            attrs="{'readonly': ['!','|','&amp;',('state','=','draft'),('is_requester','=',True),
                            					 '&amp;',('state','=','finish'),('is_cb','=',True)]}"/>
                        </group>
                        <!--Dont allow requester to see this if requester is normal employee -->
                        <!--When edit invisible attribute, you need to update domain in def read for fields -->
						<group col='4' string="Line Manager's Note" 
							attrs="{'invisible':[('can_see_hrbp_update','=',False),('is_lm','=',False),('is_requester','=',True)]}">
							<field name="lm_note" 
							 attrs="{'readonly':['!','&amp;',('state','in',['draft','supervisor']),('is_lm','=',True)],
							         'required':['&amp;',('state','in',['draft','supervisor']),('is_lm','=',True)]}"/>
						</group>
						<!--When edit invisible attribute, you need to update domain in def read for fields -->
                        <group col="4" string="HRBP Update"
                               attrs="{'invisible': [('can_see_hrbp_update','=',False)]}">
                            <newline/>
                            <field name="resignation_type" string="Type of leaving"
                            	   on_change="onchange_resignation_type(resignation_type, resignation_reason_group_id)"
                            	   context="{'is_probation_contract': is_probation_contract}"
                                   options="{'no_quick_create' : True, 'no_create':True, 'no_open': True,'save_readonly': True,'save_no_required': True}"
                                   attrs="{'readonly': ['|', '|','|', ('main_resignation_reason_id','!=',False),
                            									  ('state', 'in', ['dept_head', 'dept_hr']),
                            									  '&amp;','&amp;',('is_cb','=', False),
		                            										('is_hrbp','=', False),
		                            										('is_assistant_hrbp','=', False),
                            	
                            									'&amp;',('state','=','finish'),
																  ('is_cb','=',False) ],
                                            'required': [('can_see_hrbp_update','=',True),('is_require_in_hrbp_update','=', True)]}"
                                />
                            <field name="change_form_id" context="{'active_test' : True}"
                                   invisible="1"/>

                            <newline/>
                            <field name="resignation_reason_group_id"  
                            on_change="onchange_resignation_reason_group_id(resignation_reason_group_id, main_resignation_reason_id)"
                            options="{'no_quick_create' : True, 'no_create':True, 'no_open': True,'save_readonly': True,'save_no_required': True}"
                            
                            attrs="{'readonly': ['|','|', ('state', 'in', ['dept_head', 'dept_hr']),
                            						   '&amp;','&amp;',('is_cb','=', False),
	                            										('is_hrbp','=', False),
	                            										('is_assistant_hrbp','=', False),
                            							  '&amp;',('state','=','finish'),
																  ('is_cb','=',False)                            
                            					],
                            	'required': [('can_see_hrbp_update','=',True),('is_require_in_hrbp_update','=', True)]}"
                            context="{'resignation_type':resignation_type}" colspan='4'/>
                            
                            	
                            <field name="main_resignation_reason_id"  
                            options="{'no_quick_create' : True, 'no_create':True, 'no_open': True,'save_readonly': True,'save_no_required': True}"
                            
                            attrs="{'readonly': ['|','|', ('state', 'in', ['dept_head', 'dept_hr']),
                            						   '&amp;','&amp;',('is_cb','=', False),
	                            										('is_hrbp','=', False),
	                            										('is_assistant_hrbp','=', False),
                            						'&amp;',('state','=','finish'),
																  ('is_cb','=',False)      ],
                            	'required': [('can_see_hrbp_update','=',True),('is_require_in_hrbp_update','=', True)]}"
                            context="{'reason_group':resignation_reason_group_id,'resignation_type': resignation_type,'get_resign_reason_name_en':True}" colspan='4'/>
                            
                            <!-- invisible other reason by C&B's request == date: 23/04/2015
                            <label for="resignation_reason_ids" string="Other termination reason"/>
                            <field name="resignation_reason_ids"  context="{'resignation_type':resignation_type}" colspan='4' nolabel='1'
                            options="{'no_quick_create' : True, 'no_create':True, 'no_open': True,'save_readonly': True}"	
                            attrs="{'readonly': ['|', ('is_hrbp_watching','=', False),('state', 'in', ['dept_head', 'dept_hr', 'finish'])]}">
                            	<tree string="Resignation Reason" version="7.0">
				      				<field name="code"/>
				      				<field name="name"/>
									<field name="name_en"/>
									<field name="resignation_type_id" string="Termination Type"/>
									<field name="active"/>
				      			</tree>
			      			</field>
                            -->
                            <!--<field name="resign_reason_detail_ids" colspan="4" nolabel="1"
                                   attrs="{'readonly': ['|', ('is_hrbp_watching','=', False),('state', 'in', ['dept_head', 'dept_hr', 'finish'])],
                                           'required': [('can_see_hrbp_update','=',True),('is_require_in_hrbp_update','=', True)]}"
                                   context="{'default_resignation_type_id': resignation_type}"
                            	   on_change="onchange_resign_reason_detail_ids(resign_reason_detail_ids)"
                                   options="{'save_no_required': True}">
                                <tree string="Resign Reason Detail" version="7.0" editable="True">
                                    <field name="termination_request_id" invisible="1"/>
                                    <field name="resignation_reason_id" required="1"
                                           domain="[('resignation_type_id', '=', resignation_type_id)]"/>
                                    <field name="percentage" required="1" on_change="onchange_percentage(percentage)"
                                           sum="Total"/>
                                    <field name="description"/>
                                    <field name="resignation_type_id" invisible="1"/>
                                </tree>
                            </field>-->
                            <newline/>
                            <field name="continue_recruiting_id" colspan="4"
                                   context="{'dimension_type': 'CONTINUE_RECRUITING'}"
                                   options="{'no_quick_create' : True, 'no_create':True, 'no_open': True,'save_readonly': True,'save_no_required': True}"
                                   attrs="{'readonly': ['|','|', ('state', 'in', ['dept_head', 'dept_hr']),
                            								 '&amp;','&amp;',('is_cb','=', False),
		                            										('is_hrbp','=', False),
		                            										('is_assistant_hrbp','=', False),
                            								  '&amp;',('state','=','finish'),
																  ('is_cb','=',False)      ],
                                           'required': [('can_see_hrbp_update','=',True),('is_require_in_hrbp_update','=', True)]}"
                                    />
                            <newline/>
                            <field name="suggest_for_holding_employee" colspan="4"
                                   attrs="{'readonly': ['|','|',('state', 'in', ['dept_head', 'dept_hr']),
                            								'&amp;','&amp;',('is_cb','=', False),
		                            										('is_hrbp','=', False),
		                            										('is_assistant_hrbp','=', False),
                            							'&amp;',('state','=','finish'),
																  ('is_cb','=',False)      ]}"/>
                            <newline/>
                            <!--When edit invisible attribute, you need to update domain in def read for fields -->
                            <field name="hrbp_note" colspan="4"
                                   attrs="{'readonly': ['!','|',
                                                               ('is_cb','=', True), 
														       '&amp;',('is_person_do_action','=', True), 
                                                                  '|',
                            	                                     ('is_hrbp','=',True),
                            	                                     ('is_assistant_hrbp','=',True)],
                            	           'invisible':[('is_hrbp_watching','=',False)]}"/>
                            
                            <!--When edit invisible attribute, you need to update domain in def read for fields -->	           	
                            <field name="cb_note" colspan="4"
                                   attrs="{'readonly': [('is_cb','=', False)],'invisible':[('is_hrbp_watching','=',False)]}"/>
								<!-- '|', ('state', 'in', ['dept_head']) -->
                        </group>
                        <group string='C&amp;B Update' col="4" attrs="{'invisible': 1}">
                            <field name="resign_date" readonly="1" options="{'save_readonly': True}"/>
                            <field name="update_date"/>
                            <field name="date_response_to_af_fa_it"/>
                            <newline/>
                            <field name="decision_no"/>
                            <field name="sign_date"/>
                            <field name="signer_id" on_change="onchange_signer_id(signer_id)"/>
                            <field name="signer_job_title_id"/>
                            <field name="severance_allowance"/>
                            <newline/>
                            <newline/>
                            <field name="note" colspan="4"/>
                        </group>
                        <notebook>
                            <page string="History" groups="vhr_human_resource.vhr_cb_termination,vhr_base.hrs_group_system">
                                <label string="*** Please press F5 to refresh the list of logs !" colspan="4"/>
                                <field name="audit_log_ids" mode="tree"
                                       widget="one2many_list" readonly="1" nolabel="1" colspan="4">
                                    <tree version="7.0">
                                        <field name="timestamp" required="1" readonly="1"/>
                                        <field name="user_id" readonly="1"/>
                                        <field name="method" readonly="1"/>
                                        <field name="field_description"/>
                                        <field name="old_value_text"/>
                                        <field name="new_value_text"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Log state changes">
                                <field name="state_log_ids" readonly="1" 
                                context="{'is_show_comment':True,'is_cb':is_cb,'is_assistant':is_assistant_hrbp,
                                          'is_hrbp':is_hrbp,'is_dept_head':is_dept_head,'is_lm':is_lm,'is_requester':is_requester}"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>


        <record id="view_vhr_termination_request_tree" model="ir.ui.view">
            <field name="name">vhr.termination.request.view.tree</field>
            <field name="model">vhr.termination.request</field>
            <field name="arch" type="xml">
                <tree string="Termination Request" version="7.0"
                      colors="blue:state not in ('finish','cancel')">
                    <field name="name" string="Code"/>
                    <field name="employee_code" readonly='1'/>
                    <field name="employee_id"/>
                    <field name="company_code"/>
                    <field name="contract_id"/>
                    <field name="department_id"/>
                    <field name="job_title_id"/>
                    <field name="date_end_working_approve"/>
                    <field name="state" string="Status"/>
                    <field name="waiting_for"/>
                    <field name="waiting_time_from_previous_step"/>         
                    <field name="is_waiting_for_action" invisible='1'/>       	           
                </tree>
            </field>
        </record>

        <record id="view_vhr_termination_request_search" model="ir.ui.view">
            <field name="name">vhr.termination.request.view.search</field>
            <field name="model">vhr.termination.request</field>
            <field name="arch" type="xml">
                <search string="Termination Request">
                    <group expand="0" string="Group by...">
                        <filter string="Company" name="company" context="{'group_by':'company_id'}"/>
                        <filter string="Termination Type" icon="terp-personal+" domain="[]"
                                    context="{'group_by':'resignation_type'}"/>                                    	
                    </group>
                    <group expand="0" string="Filter by Employee">
                    	<filter string="Active Employee" name="active_employee" icon="terp-stage"
                                    domain="[('employee_id.active', '=', True)]"/>
                        <filter string="Inactive Employee" name="inactive_employee" icon="terp-stage"
                                domain="[('employee_id.active', '=', False)]"/>
                    </group>
                    <group expand="0" string="Filter by Other">
                        <filter string="Online" name="online_termination" icon="terp-stage"
                                domain="[('is_offline', '=', False)]"/>
                        <filter string="Offline" name="offline_termination" icon="terp-stage"
                                domain="[('is_offline', '=', True)]"/>
                    </group>
                    <group expand="0" string="Filter Waiting For">
        				<filter string="Waiting For Approval" name="waiting_for_action" icon="terp-stage"
                            domain="[('is_waiting_for_action', '=', True)]"/>
                    </group>
                    <group expand="0" string="Status">
                        <filter string="Draft" name="state_draft" icon="STOCK_NEW"
                                domain="[('state', '=', 'draft')]"/>
                        <filter string="Waiting LM" name="state_supervisor" icon="STOCK_NEW"
                                domain="[('state', '=', 'supervisor')]"/>
                        <filter string="Waiting HRBP" name="state_hrbp" icon="STOCK_NEW"
                                domain="[('state', '=', 'hrbp')]"/>
                        <filter string="Waiting DH" name="state_dept_head" icon="STOCK_NEW"
                                domain="[('state', '=', 'dept_head')]"/>
                        <filter string="Waiting HRD" name="state_dept_hr" icon="STOCK_NEW"
                                domain="[('state', '=', 'dept_hr')]"/>
                        <filter string="Finish" name="state_finish" icon="STOCK_NEW"
                                domain="[('state', '=', 'finish')]"/>
                        <filter string="Cancel" name="state_cancel" icon="STOCK_NEW"
                                domain="[('state', '=', 'cancel')]"/>
                    </group>
                    <field name="name" string="Termination Request"
                           filter_domain="['|','|','|','|',('name','ilike',self),('employee_id.name','ilike',self),('employee_id.login','ilike',self),('employee_id.code','ilike',self),('contract_id.name','ilike',self)]"/>

                    <field name="department_id"/>

                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="act_vhr_termination_request">
            <field name="name">Termination Requests</field>
            <field name="res_model">vhr.termination.request</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_vhr_termination_request_tree"/>
            <field name="context">{'search_default_active_employee': 1,'search_default_waiting_for_action':1,
            					   'filter_by_permission_for_termination':1,'rule_for_tree_form':True, 'export':False}</field>
            <field name="search_view_id" ref="view_vhr_termination_request_search"/>
        </record>

        <act_window
                view_mode="tree,form"
                domain="[('termination_id','=',active_id)]"
                id="act_working_record_terminate_request" name="Working Records"
                view_id="view_vhr_working_record_waiting_for_public_tree"
                res_model="vhr.working.record"
                src_model="vhr.termination.request"
                context="{'default_is_new': False, 'rule_for_tree_form': True, 'publish': False,'create':
                False,'approve':False,'return':False,'reject':False,'duplicate':False, 'default_is_latest': True,
                'record_type': 'record','get_working_record_in_flow': True}"
        />


    </data>
</openerp>